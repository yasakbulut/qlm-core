<!DOCTYPE html>

<html>
<head>
  <title>quick-load-more.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>quick-load-more.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="quick-load-more">quick-load-more</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>quick-load-more, or QLM, enables faster user response times in “load more”
scenarios. It achieves this by preemptively issuing requests to load more
items and returning them on user request. It maintains a local cache and 
aims to keep it populated above a certain number of items.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="usage">Usage</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Instantiate <code>QLM</code> using a <code>config</code> object.</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>After instantiantion, just call the <code>get()</code> method with the number of items needed.</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>example:</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">var</span> qlm = <span class="hljs-keyword">new</span> QLM({serviceURL: <span class="hljs-string">'/api/v1/products.json'</span>});
qlm.get(<span class="hljs-number">10</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(items)</span></span>{
  <span class="hljs-comment">// do something with the items here    </span>
});
<span class="hljs-comment">// This will trigger qlm.loadStarted </span>
<span class="hljs-comment">// and qlm.loadFinished events.</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> QLM = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span></span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(customConfig)</span></span>{
<span class="hljs-pi">        "use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The only critically required parameter is <code>serviceURL</code>, and 
we should make this as clear as possible.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(!customConfig.serviceURL){
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No service URL provided.'</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="configuration">Configuration</h2>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>To make QLM work, you’ll need to provide <code>serviceURL</code>, the URL of your AJAX endpoint. You’ll most likely
have to provide implementations for <code>paginator</code>, <code>isServerExhausted</code> and <code>extractItems</code> depending on your
pagination strategy.</p>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>This is the default config object, to be extended with the config the user provides.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> config = {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3 id="miscellaneous-configuration">Miscellaneous configuration</h3>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>When the item count is less than this value, a background request will be issued to load more items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            lowItemThreshold: <span class="hljs-number">20</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Configuration of events emitted by this component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            event: {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>The prefix for the events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                namespace: <span class="hljs-string">'qlm'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The names for the events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                names: {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>This will be triggered when loading starts, but not for background requests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    loadStarted: <span class="hljs-string">'loadStarted'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>This will be triggered when loading finishes, but not for background requests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    loadFinished: <span class="hljs-string">'loadFinished'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>This will be triggered in case of AJAX errors </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    error: <span class="hljs-string">'error'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>This will be triggered if it’s not possible to return any more items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    exhausted: <span class="hljs-string">'exhausted'</span>
                }
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The query parameters (if any), to be used when making requests to the server.
The parameters can be set after using the <code>setParameter</code> method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            queryParameters: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h3 id="the-paginator-object">The paginator object</h3>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>The paginator object is responsible to keep track of the pagination state and provide
a means to calculate the next state, given the previous state.</p>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>A default paginator implementation is provided. It uses <code>start</code> and <code>count</code> parameters
to paginate queries.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            paginator: {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>The paginator state. The key-value pairs inside will be serialized into the URL as
query parameters, so the schema of the <code>state</code> object will reflect your pagination
strategy.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                state: {
                    start: <span class="hljs-number">0</span>,
                    count: <span class="hljs-number">50</span>
                },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Given a state, calculate and return the next state. Ideally, this function shouldn’t
have any side effects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                next: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(currentState)</span></span>{
                    currentState.start += currentState.count;
                    <span class="hljs-keyword">return</span> currentState;
                }
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h3 id="item-exhaustion-detection">Item exhaustion detection</h3>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>To know when to stop querying the server, a means of determining whether there are no more
items to return from the server should be provided. This function, given a server response,
should return a boolean indicating whether the server ran out of items.</p>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>A default implementation is provided here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            isServerExhausted: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span></span>{
                <span class="hljs-keyword">return</span> response.exhausted;
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="item-extraction">Item extraction</h3>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>To populate the local cache, QLM needs a means of extracting items from the response. This
function, given a server response, should return an array of items.</p>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>A default implementation is provided here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            extractItems: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span></span>{
                <span class="hljs-keyword">return</span> response.items;
            }

        };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Augment the default configuration using user-supplied values, overriding when possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.extend(<span class="hljs-literal">true</span>, config, customConfig);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>The item storage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> localCache = [],</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>shortcuts to the functions in the config</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            paginator = config.paginator,
            isServerExhausted = config.isServerExhausted,
            extractItems = config.extractItems,</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>The promise object of the ongoing server request (if any)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ongoingRequestPromise = <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Issues a GET request to the server, to populate the local cache.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            populateLocalCache = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                ongoingRequestPromise = $.ajax({
                    url: getURL(config.queryParameters, paginator.state),
                    type: <span class="hljs-string">"GET"</span>
                }).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span></span>{
                    ongoingRequestPromise = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>extract items from the response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> items = extractItems(response);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>append the items to the local cache</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-built_in">Array</span>.prototype.push.apply(localCache, items);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>move the pagination state forward</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    paginator.state = paginator.next(paginator.state);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>trigger the exhaustion event if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span>(isServerExhausted(response)){
                        triggerEvent(<span class="hljs-string">'exhausted'</span>);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>return retrieved items count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> items.length;

                }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span></span>{
                    ongoingRequestPromise = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">return</span> error;
                });
                <span class="hljs-keyword">return</span> ongoingRequestPromise;
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Constructs an URL from the current state, i.e. query parameters and the pagination state.
For each <code>state</code>, query parameters in the form of<code>key=value</code> will be generated from
<code>key: value</code> pairs in the <code>state</code> objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            getURL = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parameters, paginatorState)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>this array will hold all the query parameters in the <code>key=value</code> form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> queryParameters = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>For both parameters and paginationState</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $.each(<span class="hljs-built_in">arguments</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, argument)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>For each key in the state object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $.each(argument, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parameterName, value)</span></span>{

                        <span class="hljs-keyword">var</span> queryParameter = <span class="hljs-string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>When serializing an array of form <code>a = [1,2,3]</code>, the format <code>a=1&amp;a=2&amp;a=3</code> is used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span>($.isArray(value)){
                            queryParameter = $.map(value, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span></span>{ <span class="hljs-keyword">return</span> parameterName + <span class="hljs-string">'='</span> + v; }).join(<span class="hljs-string">'&amp;'</span>);
                        }<span class="hljs-keyword">else</span>{
                            queryParameter = parameterName + <span class="hljs-string">'='</span> + value;
                        }

                        queryParameters.push(queryParameter);
                    });
                });

                <span class="hljs-keyword">return</span> config.serviceURL + <span class="hljs-string">'?'</span> + queryParameters.join(<span class="hljs-string">'&amp;'</span>);
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Sets a query parameter to be used in the next request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setParameter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parameter, value)</span></span>{
                config.parameterState[parameter] = value;
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Gets the value of a query parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            getParameter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parameter)</span></span>{
                <span class="hljs-keyword">return</span> config.parameterState[parameter];
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Returns an array containing the specified number of items. The size of the returned
list may be less than <code>numberOfItems</code> if not enough items exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            get = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(numberOfItems)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>If a background request is already being made to the server, reuse the promise, and attach the callback to its chain</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (ongoingRequestPromise) {
                    <span class="hljs-keyword">return</span> ongoingRequestPromise.then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                        <span class="hljs-keyword">return</span> get(numberOfItems);
                    });
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>if the number of items in the local cache is insufficent </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span>(localCache.length &lt; numberOfItems){</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>create a chainer, to check if we have enough items after a server response, and
reissue a request if more items are needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> chainer = createPromiseChainer({
                        predicate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                            <span class="hljs-keyword">return</span> localCache.length &lt; numberOfItems;
                        },
                        promiseFn: populateLocalCache
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>trigger the load started event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    triggerEvent(<span class="hljs-string">'loadStarted'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>populate the local cache, issuing a request to the server, and return
the promise to allow attaching of then() calls</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> populateLocalCache().then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>get more items if needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">return</span> chainer();
                    }).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(retrievedItemCount)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>get and remove items from the local cache, starting from the beginning </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">var</span> items = localCache.splice(<span class="hljs-number">0</span>, numberOfItems);</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>trigger the load finished event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        triggerEvent(<span class="hljs-string">'loadFinished'</span>);

                        <span class="hljs-keyword">return</span> items;
                    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span></span>{
                        triggerEvent(<span class="hljs-string">'loadFinished'</span>);
                        triggerEvent(<span class="hljs-string">'error'</span>);
                    });

                }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>if we have enough items in the local cache </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> $.Deferred(),</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>get and remove items from the local cache, starting from the beginning </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    items = localCache.splice(<span class="hljs-number">0</span>, numberOfItems);</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>attach the items to the deferred and resolve it </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                result.resolve(items);</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>if we’re running low on items, issue a background request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span>(localCache.length &lt; config.lowItemThreshold){
                    ongoingRequestPromise = populateLocalCache();
                }

                <span class="hljs-keyword">return</span> result;
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>trigger an event with the given name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            triggerEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{
                <span class="hljs-keyword">var</span> eventName = config.event.namespace + <span class="hljs-string">'.'</span> + config.event.names[event];
                $(<span class="hljs-built_in">document</span>).trigger(eventName);
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>TODO: extract this to its own module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            createPromiseChainer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span></span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">chainer</span><span class="hljs-params">()</span></span>{
                    <span class="hljs-keyword">if</span>(options.predicate()){
                        <span class="hljs-keyword">var</span> promise =  options.promiseFn();
                        <span class="hljs-keyword">return</span> promise.then(chainer);
                    }<span class="hljs-keyword">else</span>{
                        <span class="hljs-keyword">var</span> result =  <span class="hljs-keyword">new</span> $.Deferred();
                        result.resolve();
                        <span class="hljs-keyword">return</span> result;
                    }
                };
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <h2 id="public-api">Public API</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h3 id="get-number-promise-object-">get(number): Promise(Object[])</h3>

            </div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Returns a promise which resolves with a list of objects. The number of
objects returned is less than (if there is not enough items on the server)
or equal to (in the normal case) the input parameter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            get: get,</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h3 id="setparameter-key-value-void">setParameter(key, value): void</h3>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Sets a query parameter to use in the next query to the server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setParameter: setParameter,</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <h3 id="getparameter-value-string-number-array">getParameter(value): String / Number / Array</h3>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Gets the value of a query parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            getParameter: getParameter,

            __getURL: getURL,
            __localCache: localCache
        };
    };
})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
